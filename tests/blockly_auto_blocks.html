<html>
<head>

<script src="blockly_compressed.js" type="text/javascript" charset="utf-8"></script>
<script src="blocks_compressed.js" type="text/javascript" charset="utf-8"></script>
<script src="python_compressed.js" type="text/javascript"></script>

<script type="text/javascript" src="msg/js/en.js"></script>

<script src="pythonjs.js"></script>
<script src="bindings/blockly.py"></script>

<xml id="toolbox" style="display: none">
	<category name="Conditionals">
	<block type="controls_if"></block>
	<block type="controls_if">
	  <mutation else="1"></mutation>
	</block>
	<block type="controls_if">
	  <mutation elseif="1" else="1"></mutation>
	</block>
	</category>
	<category name="Loops">
	<block type="controls_repeat_ext">
	  <value name="TIMES">
	    <block type="math_number">
	      <title name="NUM">10</title>
	    </block>
	  </value>
	</block>
	<block type="controls_whileUntil"></block>
	<block type="controls_for">
	  <title name="VAR">i</title>
	  <value name="FROM">
	    <block type="math_number">
	      <title name="NUM">1</title>
	    </block>
	  </value>
	  <value name="TO">
	    <block type="math_number">
	      <title name="NUM">10</title>
	    </block>
	  </value>
	  <value name="BY">
	    <block type="math_number">
	      <title name="NUM">1</title>
	    </block>
	  </value>
	</block>
	<block type="controls_forEach"></block>
	<block type="controls_flow_statements"></block>
	</category>

	<category name="Logic">
	  <block type="logic_compare"></block>
	  <block type="logic_operation"></block>
	  <block type="logic_negate"></block>
	  <block type="logic_boolean"></block>
	  <block type="logic_null"></block>
	  <block type="logic_ternary"></block>
	</category>
	<category name="Math">
	  <block type="math_number"></block>
	  <block type="math_arithmetic"></block>
	  <block type="math_single"></block>
	  <block type="math_trig"></block>
	  <block type="math_constant"></block>
	  <block type="math_number_property"></block>
	  <block type="math_change">
	    <value name="DELTA">
	      <block type="math_number">
	        <title name="NUM">1</title>
	      </block>
	    </value>
	  </block>
	  <block type="math_round"></block>
	  <block type="math_on_list"></block>
	  <block type="math_modulo"></block>
	  <block type="math_constrain">
	    <value name="LOW">
	      <block type="math_number">
	        <title name="NUM">1</title>
	      </block>
	    </value>
	    <value name="HIGH">
	      <block type="math_number">
	        <title name="NUM">100</title>
	      </block>
	    </value>
	  </block>
	  <block type="math_random_int">
	    <value name="FROM">
	      <block type="math_number">
	        <title name="NUM">1</title>
	      </block>
	    </value>
	    <value name="TO">
	      <block type="math_number">
	        <title name="NUM">100</title>
	      </block>
	    </value>
	  </block>
	  <block type="math_random_float"></block>
	</category>
	<category name="Lists">
	  <block type="lists_create_empty"></block>
	  <block type="lists_create_with"></block>
	  <block type="lists_repeat">
	    <value name="NUM">
	      <block type="math_number">
	        <title name="NUM">5</title>
	      </block>
	    </value>
	  </block>
	  <block type="lists_length"></block>
	  <block type="lists_isEmpty"></block>
	  <block type="lists_indexOf"></block>
	  <block type="lists_getIndex"></block>
	  <block type="lists_setIndex"></block>
	</category>
	<category name="Variables" custom="VARIABLE"></category>
	<category name="Functions" custom="PROCEDURE"></category>
</xml>


</head>

<body>

<button onclick="test()">set test values using setInterval</button>


<div id="blocklyDiv" style="height: 380px; width: 700px;"></div>



<script type="text/python">
from blockly import *

block = StatementBlock(title='My Block', category='Classes')

@block.bind_class
@pythonjs.init_callbacks
@pythonjs.property_callbacks
class A:
	def __init__(self, x=1, y=2, z=3):
		self._x=x
		self._y=y
		self._z=z

	@returns( float )
	@property
	def x(self):
		return self._x
	@x.setter
	def x(self, value):
		self._x = value

	@returns( float )
	@property
	def y(self):
		return self._y
	@y.setter
	def y(self, value):
		self._y = value

	@returns( float )
	@property
	def z(self):
		return self._z
	@z.setter
	def z(self, value):
		self._z = value


#block.bind_class( A )  ## this also works

with javascript:
	def dd_callback(value):
		print this
		print this.property_name
		print value

block.add_dropdown(
	'myoption',		# name
	title = None,	# no title puts it on header
	items=['a','b','c'],
	callback=dd_callback
)

def show_code():
	with javascript:
		code = Blockly.Python.workspaceToCode()
		print( code )


print 'init blockly'
initialize_blockly( on_changed_callback=show_code )

## nov3rd - there is a bug in our scope and var generator, 
## a.block.moveTo fails because `i` becomes zero after `a=A()`
#for i in range(4):
#	a = A()
#	a.x = '99'
#	a.block.moveTo( i*130, 30 )

with static:
	instances = []

def setup():
	for i in range(4):
		a = A()
		a.x = '99'
		a.block.moveTo( i*130, 30 )
		instances.append( a )
setup()

x = 0
y = 1
z = 2
def test_fields():
	global x,y,z
	for item in instances:
		item.x = x
		item.y = y
		item.z = z

	x += 1
	y += 1
	z += 1

def test():
	window.setInterval(test_fields, 300)

</script>


</body>
</html>